<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>The easiest and fastest way to create beautiful interactive maps in Python | Paul Xu</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="alternate" type="application/rss+xml" href="https://digicosmos86.github.io/datascience-blog/rss.xml" title="Paul Xu RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://digicosmos86.github.io/datascience-blog/feed.atom" title="Paul Xu Atom Feed">
    <link rel="alternate" type="application/json" href="https://digicosmos86.github.io/datascience-blog/feed.json" title="Paul Xu JSON Feed">
    <meta name="description" content="Create any map that you can use anywhere">
    <link rel="preload" href="/datascience-blog/assets/css/0.styles.e7aed4d3.css" as="style"><link rel="preload" href="/datascience-blog/assets/js/app.b17b81b1.js" as="script"><link rel="preload" href="/datascience-blog/assets/js/7.7ac7c303.js" as="script"><link rel="preload" href="/datascience-blog/assets/js/3.ea1e0928.js" as="script"><link rel="preload" href="/datascience-blog/assets/js/18.81f8c0a2.js" as="script"><link rel="preload" href="/datascience-blog/assets/js/5.04ce5a0a.js" as="script"><link rel="preload" href="/datascience-blog/assets/js/8.845dbd27.js" as="script"><link rel="prefetch" href="/datascience-blog/assets/js/10.2018d35c.js"><link rel="prefetch" href="/datascience-blog/assets/js/11.36817d41.js"><link rel="prefetch" href="/datascience-blog/assets/js/12.ac235030.js"><link rel="prefetch" href="/datascience-blog/assets/js/13.8feb1837.js"><link rel="prefetch" href="/datascience-blog/assets/js/14.be037bbf.js"><link rel="prefetch" href="/datascience-blog/assets/js/15.3bfa0666.js"><link rel="prefetch" href="/datascience-blog/assets/js/16.1602659e.js"><link rel="prefetch" href="/datascience-blog/assets/js/17.0af8a4ff.js"><link rel="prefetch" href="/datascience-blog/assets/js/19.fd117c3f.js"><link rel="prefetch" href="/datascience-blog/assets/js/20.fb02e34a.js"><link rel="prefetch" href="/datascience-blog/assets/js/21.e7aa03b8.js"><link rel="prefetch" href="/datascience-blog/assets/js/22.c6e1b0b1.js"><link rel="prefetch" href="/datascience-blog/assets/js/23.ce3a10a1.js"><link rel="prefetch" href="/datascience-blog/assets/js/4.2d9bfa2a.js"><link rel="prefetch" href="/datascience-blog/assets/js/6.5ab5f3c5.js"><link rel="prefetch" href="/datascience-blog/assets/js/9.4ebd6a84.js"><link rel="prefetch" href="/datascience-blog/assets/js/vuejs-paginate.0cbd6f70.js">
    <link rel="stylesheet" href="/datascience-blog/assets/css/0.styles.e7aed4d3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><nav class="navbar navbar-expand-md navbar-light bg-white fixed-top"><div class="container"><a href="/datascience-blog/" class="navbar-brand"><img src="/datascience-blog/assets/img/logo.svg"></a> <button type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler"><span class="navbar-toggler-icon"></span></button> <div id="navbarsExampleDefault" class="collapse navbar-collapse"><ul class="navbar-nav ml-auto"><li class="nav-item"><a href="/datascience-blog/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/datascience-blog/tag/" class="nav-link">Tags</a></li><li class="nav-item"><a href="https://thepolicylab.brown.edu/team/paul-xu/" target="_blank" rel="noopener noreferrer" class="external nav-link">About</a></li> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <a href="./rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a> <div style="margin-left:0.5rem;" data-v-7e575099><a href="https://github.com/digicosmos86" target="_blank" class="github" data-v-7e575099><svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-7e575099 data-v-7e575099><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-7e575099 data-v-7e575099></path></svg>Github
  </a></div></ul></div></div></nav></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/datascience-blog/" class="mobile-home-link navbar-brand"><img src="/datascience-blog/assets/img/logo.svg"></a> <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/datascience-blog/">Blog</a></li><li class="mobile-nav-item"><a href="/datascience-blog/tag/">Tags</a></li><li class="mobile-nav-item"><a href="https://thepolicylab.brown.edu/team/paul-xu/" target="_blank" rel="noopener noreferrer" class="external">About</a></li> <li class="mobile-nav-item"><a href="./rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></li> <li class="mobile-nav-item"><div data-v-7e575099><a href="https://github.com/digicosmos86" target="_blank" class="github" data-v-7e575099><svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-7e575099 data-v-7e575099><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-7e575099 data-v-7e575099></path></svg>Github
  </a></div></li></ul></div></div></div> <div class="container wrapmain"><div id="vuepress-theme-blog__post-layout" data-v-1c1f12bb><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content" data-v-1c1f12bb><div class="row justify-content-center" data-v-1c1f12bb><div class="col-md-8" data-v-1c1f12bb><header data-v-1c1f12bb><span class="text-muted" data-v-1c1f12bb><div class="post-meta" data-v-1c1f12bb><!----> <div class="post-meta-date"><time pubdate itemprop="datePublished" datetime="2020/07/17">
Fri, Jul 17 2020
</time></div> <!----></div></span> <h1 itemprop="name headline" class="article-head mt-3" data-v-1c1f12bb>
  The easiest and fastest way to create beautiful interactive maps in Python
  </h1> <p class="lead" data-v-1c1f12bb>Create any map that you can use anywhere</p> <div data-v-1c1f12bb><span><div class="d-flex align-items-center"><a class="profile-avatar"><img src="/datascience-blog/assets/img/myAvatar.png" alt="Paul Xu" class="avatar-image"></a> <div><span>Paul Xu</span> Â 
      <a href="https://thepolicylab.brown.edu/team/paul-xu/" target="_blank" rel="noopener noreferrer" class="external btn btn-sm btn-outline-dark">Follow</a></div></div></span><span><div class="d-flex align-items-center"><a class="profile-avatar"><!----></a> <!----></div></span></div></header></div></div> <div class="row justify-content-center text-center mt-4 mb-40" data-v-1c1f12bb><div class="col-md-9" data-v-1c1f12bb><img src="/datascience-blog/assets/img/d3-map.png" class="featuredimg" data-v-1c1f12bb></div></div> <div class="row justify-content-center" data-v-1c1f12bb><div class="col-md-8" data-v-1c1f12bb><div itemprop="articleBody" class="content__default" data-v-1c1f12bb><p>If you are like me, you would be fascinated by the beautiful interactive maps (choropleths) on New York Times (see <a href="https://www.nytimes.com/interactive/2020/07/17/upshot/coronavirus-face-mask-map.html?action=click&amp;module=Top%20Stories&amp;pgtype=Homepage" target="_blank" rel="noopener noreferrer">this<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, for example). They are not only informative but also quite eye catching. You can create a map like this in d3.js fairly easily, but it takes time. Plus you would probably need to wrangle some data first in Python first. Is there a way to create interactive maps like this quickly without leaving Python? This article is for you. I will cover the basics in creating interactive choropleths with the <code>altair</code> package any state or region that you have a <code>geojson</code> or <code>topojson</code> for.</p> <h2 id="what-is-altair"><a href="#what-is-altair" class="header-anchor">#</a> What is <code>altair</code>?</h2> <p><code>altair</code> is a relatively new data visualization package for Python that creates <code>vega</code> and <code>vega-lite</code> bindings. <code>vega</code> and <code>vega-lite</code> are &quot;a <em>visualization grammar</em>, a declarative language for creating, saving, and sharing interactive visualization designs. With Vega, you can describe the visual appearance and interactive behavior of a visualization in a JSON format, and generate web-based views using Canvas or SVG.&quot; <code>altair</code> is a package that creates such JSON files which then can be parsed with <code>vega</code> and <code>vega-lite</code> engines that uses d3 under-the-hood to create common types of statistical charts. I have written <a href="/datascience-blog/_posts/forget-about-matplotlib.you-should-be-using-altair.html">a high-level overview</a> of <code>altair</code> that explains why you should be using <code>altair</code> instead of, say, <code>matplotlib</code>, <code>seaborn</code>, <code>bokeh</code>, or <code>plotly</code>.</p> <h2 id="get-started-plotting"><a href="#get-started-plotting" class="header-anchor">#</a> Get Started Plotting!</h2> <p>The easiest way to get started with <code>altair</code> is in a <code>jupyter notebook</code> environment. You can start a notebook in <a href="https://colab.research.google.com/" target="_blank" rel="noopener noreferrer">Google Colab<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and follow along. I have created <a href="https://colab.research.google.com/drive/1YopGikLVbD766fPS_tuWlj2bzpSMB2c0?usp=sharing" target="_blank" rel="noopener noreferrer">this Colab notebook<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> with all the code that you are going to see. If you want to code locally, I recommend <code>jupyter lab</code> simply because <code>altair</code> works in Jupyter Lab by default. Follow these commands to set up a virtual environment and start Jupyter Lab. If you prefer other IDEs, please refer to <a href="https://altair-viz.github.io/user_guide/display_frontends.html" target="_blank" rel="noopener noreferrer">this article<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> from the <code>altair</code> documentation.</p> <h3 id="step-1-plot-a-base-map"><a href="#step-1-plot-a-base-map" class="header-anchor">#</a> Step 1. Plot a base map</h3> <p>As a warm up activity, we will be plotting a map of Rhode Island with only outlines and all default settings just to get used to <code>altair</code>. You can start with any <code>geojson</code> or <code>topojson</code> file that you want. We are going to be using <a href="https://thepolicylab.github.io/UW-211/ri.topo.json" target="_blank" rel="noopener noreferrer">this topojson file of Rhode Island municipalities<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. It is also the same file that I used to create the map in <a href="https://thepolicylab.github.io/UW-211/" target="_blank" rel="noopener noreferrer">this dashboard<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to visualize 211 calls received by United Way of Rhode Island.</p> <p><code>altair</code> supports reading data files through http directly. You don't even need to load the json file:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> altair <span class="token keyword">as</span> alt

ri_topo_url <span class="token operator">=</span> <span class="token string">'https://thepolicylab.github.io/UW-211/ri.topo.json'</span>

<span class="token comment"># A convenience function that converts topojson features to geojson features</span>
ri_municipalities <span class="token operator">=</span> alt<span class="token punctuation">.</span>topo_feature<span class="token punctuation">(</span>ri_topo_url<span class="token punctuation">,</span> <span class="token string">'ri'</span><span class="token punctuation">)</span>

alt<span class="token punctuation">.</span>Chart<span class="token punctuation">(</span>ri_municipalities<span class="token punctuation">)</span><span class="token punctuation">.</span>mark_geoshape<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/datascience-blog/assets/img/visualization-4.png" alt=""></p> <p>Voila! A map of Rhode Island should show up. It is that easy! Of course, we are not mapping any data to it, but we will get to that soon.</p> <p>Let's unpack a little bit about what's going on here:</p> <ol><li><code>altair</code> works with both <code>geojson</code> and <code>topojson</code> formats, but <code>topojson</code> needs to be converted to <code>geojson</code> format before it can be rendered. That's why we use the convenient function <code>alt.topo_feature()</code> to extract the features from <code>topojson</code>.</li> <li>The second argument to <code>alt.topo_feature()</code> is a string that specifies the name of the object in the <code>topojson</code> that holds the <code>geometryCollection</code> in topojson. You can typically find it within the <code>objects</code> object in the <code>topojson</code> file. In this case, the name of that object is <code>ri</code>. You can click on <a href="https://thepolicylab.github.io/UW-211/ri.topo.json" target="_blank" rel="noopener noreferrer">this link to the json file to see its content<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>The <code>Chart</code> object is the top-level object in <code>altair</code> that provides an entry into the plot. It accepts a data source as its argument. <code>altair</code> supports many data source types. In this case, it is a geospatial data source. It also accepts pandas DataFrames, geoPandas geoDataFrames, plain jsons, and many others (<a href="https://altair-viz.github.io/user_guide/data.html" target="_blank" rel="noopener noreferrer">full documentation here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>). Notably, it supports urls to <code>csv</code> and <code>json</code> formats, so you don't have to download them first.</li> <li>Because we used <code>alt.topo_feature</code>, <code>altair</code> knows there is geospatial information in the plot, so it created the plot by default.</li> <li>We specified that we are creating <code>geoshapes</code> as marks. We can specify how these shapes should look. These are basically CSS propeties of SVG shapes. If you have experience working with SVGs with CSS, you should be very familiar with the arguments here:</li></ol> <div class="language-python extra-class"><pre class="language-python"><code>alt<span class="token punctuation">.</span>Chart<span class="token punctuation">(</span>ri_municipalities<span class="token punctuation">)</span><span class="token punctuation">.</span>mark_geoshape<span class="token punctuation">(</span>
    fill<span class="token operator">=</span><span class="token string">'teal'</span><span class="token punctuation">,</span>
    stroke<span class="token operator">=</span><span class="token string">'#fff'</span><span class="token punctuation">,</span>
    strokeWidth<span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span>properties<span class="token punctuation">(</span>
	width<span class="token operator">=</span><span class="token number">600</span><span class="token punctuation">,</span>
    height<span class="token operator">=</span><span class="token number">800</span><span class="token punctuation">,</span>
    title<span class="token operator">=</span><span class="token string">&quot;Map of Rhode Island Municipalities&quot;</span>
<span class="token punctuation">)</span>
</code></pre></div><p><img src="/datascience-blog/assets/img/visualization-5.png" alt=""></p> <p>Notice that we can pass these options directly to the <code>mark_geoshape()</code> method. Here we are <strong>specifying</strong> or <strong>assigning</strong> the properties of the shapes, not <strong>mapping</strong> or <strong>encoding</strong> the properties with data. Next, we are going to encode some data to the map.</p> <p>We also used the <code>properties</code> method to specify general properties of the charts, such as height, weight, and title. The <code>altair</code> API is very well structured and predictable in many ways about how you can use them.</p> <h3 id="step-2-scrape-some-data-for-the-map-to-encode"><a href="#step-2-scrape-some-data-for-the-map-to-encode" class="header-anchor">#</a> Step 2. Scrape some data for the map to encode</h3> <p>Let's simply scrape the population data for Rhode Island municipalities as an example for this post. We can use <code>pandas.read_html()</code> for this. It basically reads all tables on an html page and saves them as a list of DataFrames. The data source is <a href="https://en.wikipedia.org/wiki/List_of_municipalities_in_Rhode_Island" target="_blank" rel="noopener noreferrer">this wikipedia page<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token comment"># use requests to obtain the html sourse</span>
wiki_page <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://en.wikipedia.org/wiki/List_of_municipalities_in_Rhode_Island'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text

<span class="token comment"># use pandas to parse the html file and extact all tables</span>
ri_table <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_html<span class="token punctuation">(</span>wiki_page<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
ri_pops <span class="token operator">=</span> ri_table<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment"># get rid of the last (total) row</span>
ri_pops<span class="token punctuation">.</span>columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'City'</span><span class="token punctuation">,</span> <span class="token string">'Population'</span><span class="token punctuation">]</span>
ri_pops<span class="token punctuation">[</span><span class="token string">&quot;City&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> ri_pops<span class="token punctuation">[</span><span class="token string">&quot;City&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>
ri_pops<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>City	Population
BARRINGTON	16819
BRISTOL	22469
BURRILLVILLE	15796
CENTRAL FALLS	18928
CHARLESTOWN	7859
</code></pre></div><p>With this step, we now have a DataFrame of all municipalities in Rhode Island and their populations. The next step would be to <code>map</code> or <code>encode</code> this data to the map.</p> <h3 id="step-3-encode-data-to-the-map"><a href="#step-3-encode-data-to-the-map" class="header-anchor">#</a> Step 3. Encode data to the map</h3> <p>This step is basically to join the population data with the <code>topojson</code> file. In the <code>topojson</code> file, each shape is associated with an <code>id</code> which is the upper-case name of the municipality it represents. We would be using this <code>id</code> as the key to look up for the corresponding population in the DataFrame that we just created. Normally a join with pandas would solve the problem. The problem here, though, is that we don't have two DataFrames here. This is where <code>altair</code>'s data transformations come in handy. The data transformation API are bindings to <code>vega</code>'s powerful data transformations on JavaScript datasets. In Python, the data transformation API can operate between data saved in JSON format and DataFrame formats, which is very powerful.</p> <p>Let's slightly modify the code that we created previously to map the population to the color of each shape:</p> <div class="language-python extra-class"><pre class="language-python"><code>alt<span class="token punctuation">.</span>Chart<span class="token punctuation">(</span>ri_municipalities<span class="token punctuation">)</span><span class="token punctuation">.</span>mark_geoshape<span class="token punctuation">(</span>
    stroke<span class="token operator">=</span><span class="token string">'#fff'</span><span class="token punctuation">,</span>
    strokeWidth<span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span>
    color<span class="token operator">=</span><span class="token string">'Population:Q'</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span>transform_lookup<span class="token punctuation">(</span>
    lookup<span class="token operator">=</span><span class="token string">'id'</span><span class="token punctuation">,</span>
    from_<span class="token operator">=</span>alt<span class="token punctuation">.</span>LookupData<span class="token punctuation">(</span>data<span class="token operator">=</span>ri_pops<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token string">'City'</span><span class="token punctuation">,</span> fields<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Population'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span>properties<span class="token punctuation">(</span>
	width<span class="token operator">=</span><span class="token number">600</span><span class="token punctuation">,</span>
    height<span class="token operator">=</span><span class="token number">800</span><span class="token punctuation">,</span>
    title<span class="token operator">=</span><span class="token string">&quot;Rhode Island City Population&quot;</span>
<span class="token punctuation">)</span>
</code></pre></div><p><img src="/datascience-blog/assets/img/visualization-6.png" alt=""></p> <p>A few things happened here: first, we performed a &quot;lookup transformation&quot;, which basically works like SQL joins. For each <code>id</code> in the <code>topojson</code>, we lookup the data in the <code>ri_pops</code> DataFrame, find matching values in the <code>City</code> (<code>key</code>) column, and bringing the <code>Population</code> values. Then the <code>Population</code> values can be considered an added column in the original data.</p> <p>Next, we &quot;encode&quot; the population values as the color for each shape. The &quot;:Q&quot; shorthand specifies that these are quantitaive (continuous) values, so <code>altair</code> will use a continuous scale for the colors. We now have a map with colors mapped to each tile! By the way, you can now remove the &quot;fill&quot; argument to the &quot;mark_geoshape()&quot; attribute since we are no longer using that.</p> <h3 id="step-4-customize-color-scales"><a href="#step-4-customize-color-scales" class="header-anchor">#</a> Step 4. Customize color scales</h3> <p>The results already looks very good but if you don't like the default color scales, you can customize the color scale according to your preferences. This is also very easy to do in <code>altair</code> but involves diving a bit more into the inner workings of <code>altair</code>.</p> <div class="language-python extra-class"><pre class="language-python"><code>alt<span class="token punctuation">.</span>Chart<span class="token punctuation">(</span>ri_municipalities<span class="token punctuation">)</span><span class="token punctuation">.</span>mark_geoshape<span class="token punctuation">(</span>
    stroke<span class="token operator">=</span><span class="token string">'#fff'</span><span class="token punctuation">,</span>
    strokeWidth<span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span>
    color<span class="token operator">=</span>alt<span class="token punctuation">.</span>Color<span class="token punctuation">(</span><span class="token string">'Population:Q'</span><span class="token punctuation">,</span> scale<span class="token operator">=</span>alt<span class="token punctuation">.</span>Scale<span class="token punctuation">(</span>interpolate<span class="token operator">=</span><span class="token string">'rgb'</span><span class="token punctuation">,</span> scheme<span class="token operator">=</span><span class="token string">'blues'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span>transform_lookup<span class="token punctuation">(</span>
    lookup<span class="token operator">=</span><span class="token string">'id'</span><span class="token punctuation">,</span>
    from_<span class="token operator">=</span>alt<span class="token punctuation">.</span>LookupData<span class="token punctuation">(</span>data<span class="token operator">=</span>ri_pops<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token string">'City'</span><span class="token punctuation">,</span> fields<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Population'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span>properties<span class="token punctuation">(</span>
	  width<span class="token operator">=</span><span class="token number">600</span><span class="token punctuation">,</span>
    height<span class="token operator">=</span><span class="token number">800</span><span class="token punctuation">,</span>
    title<span class="token operator">=</span><span class="token string">&quot;Rhode Island City Population&quot;</span>
<span class="token punctuation">)</span>
</code></pre></div><p><img src="/datascience-blog/assets/img/visualization-7.png" alt=""></p> <p>The only thing that changed was what was passed to the <code>color</code> argument of the encode method. Turns out, you can directly pass a string &quot;shorthand&quot; to this argument, and <code>altair</code> will generate the rest by default. However, you can also directly specify all the options in the mapping, such as the scale it uses, and how the numerical values are mapped to colors, and which color schemes are used. Here <code>alt.Color()</code> and <code>alt.Scale()</code> are wrappers that wrap all of the options and keep these options neatly organized. Here we switched to the &quot;blues&quot; color scheme. You can use any scheme that <code>vega</code> provides (<a href="https://vega.github.io/vega/docs/schemes/" target="_blank" rel="noopener noreferrer">documentation here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>), which is also what is available in <code>d3,js</code>. You can also specify a scheme yourself by providing a list of two CSS-compatible color values to the <code>range</code> parameter of <code>alt.Scale()</code>.</p> <h3 id="step-5-add-interactive-tooltips"><a href="#step-5-add-interactive-tooltips" class="header-anchor">#</a> Step 5. Add interactive tooltips</h3> <p>The last step in this post is to make this map interactive by adding tooltips. This is also very easy:</p> <div class="language-python extra-class"><pre class="language-python"><code>alt<span class="token punctuation">.</span>Chart<span class="token punctuation">(</span>ri_municipalities<span class="token punctuation">)</span><span class="token punctuation">.</span>mark_geoshape<span class="token punctuation">(</span>
    stroke<span class="token operator">=</span><span class="token string">'#fff'</span><span class="token punctuation">,</span>
    strokeWidth<span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span>
    color<span class="token operator">=</span>alt<span class="token punctuation">.</span>Color<span class="token punctuation">(</span><span class="token string">'Population:Q'</span><span class="token punctuation">,</span> scale<span class="token operator">=</span>alt<span class="token punctuation">.</span>Scale<span class="token punctuation">(</span>interpolate<span class="token operator">=</span><span class="token string">'rgb'</span><span class="token punctuation">,</span> scheme<span class="token operator">=</span><span class="token string">'blues'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    tooltip<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'id:N'</span><span class="token punctuation">,</span> <span class="token string">'Population:Q'</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span>transform_lookup<span class="token punctuation">(</span>
    lookup<span class="token operator">=</span><span class="token string">'id'</span><span class="token punctuation">,</span>
    from_<span class="token operator">=</span>alt<span class="token punctuation">.</span>LookupData<span class="token punctuation">(</span>data<span class="token operator">=</span>ri_pops<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token string">'City'</span><span class="token punctuation">,</span> fields<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Population'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span>properties<span class="token punctuation">(</span>
	width<span class="token operator">=</span><span class="token number">600</span><span class="token punctuation">,</span>
    height<span class="token operator">=</span><span class="token number">800</span><span class="token punctuation">,</span>
    title<span class="token operator">=</span><span class="token string">&quot;Rhode Island City Population&quot;</span>
<span class="token punctuation">)</span>
</code></pre></div><p>That's it! When you hover over each shape a tooltip will show up and display the values of the <code>id</code> and <code>Population</code> fields. You can, of course, deeply customize these tooltips. You guessed it. You can use <code>alt.Tooltip()</code> wrapper to provide more specifications. Here I am changing only the <code>id</code> field because I want the tooltip to display <code>City</code> as the title rather than `id':</p> <div class="language-python extra-class"><pre class="language-python"><code>	tooltip<span class="token operator">=</span><span class="token punctuation">[</span>alt<span class="token punctuation">.</span>Tooltip<span class="token punctuation">(</span><span class="token string">'id:N'</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">'City'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'Population:Q'</span><span class="token punctuation">]</span>
</code></pre></div><h3 id="step-6-share-your-work"><a href="#step-6-share-your-work" class="header-anchor">#</a> Step 6: Share your work!</h3> <p>Can you use these beautiful maps anywhere else? For sure! You can click on the three-dot menu on the top right corner of any visualization to save the map in PNG or SVG formats. You can also use <code>Chart().save()</code> to save the chart to a plain html file with all the interactions included. Of course, because that html file loads the vega engine in JavaScript, you need to be online for the chart to render. You can also save the <code>vega</code> and <code>vega-lite</code> JSON schema to a JSON file that can be loaded by other Web apps.</p> <h2 id="summary"><a href="#summary" class="header-anchor">#</a> Summary:</h2> <p>In this post I covered how to use <code>altair</code> to make any map with a <code>topojson</code> or <code>geojson</code> file. We went over the following steps:</p> <ol><li>Loading a <code>topojson</code> from a url and using <code>alt.topo_feature</code> to extract geospatial information.</li> <li>Creating a basemap and specifying a value vs. mapping (encoding) a value.</li> <li>Using &quot;lookup transformation&quot; to link data from another source to the <code>topojson</code></li> <li>Using wrappers to provide more customizations beyond the default.</li> <li>Interactive tooltips.</li> <li>Sharing your map.</li></ol> <p>I have shared the code in this post in this <a href="https://colab.research.google.com/drive/1YopGikLVbD766fPS_tuWlj2bzpSMB2c0?usp=sharing" target="_blank" rel="noopener noreferrer">Google Colab notebook<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Feel free to create your own copy and change the code to see what is possible with <code>altair</code>!</p> <p>Now you know all the basics of 'altair' mapping. In the next post, we are going to use <code>altair</code> for a real-world project - we are going to visualize Boston 311 call data with <code>altair</code>! There will be more advanced topics such as faceting and building simple dashboard with filters! Please stay tuned!</p></div> <div class="post-meta" data-v-1c1f12bb><!----> <!----> <div itemprop="keywords" class="card-subheading post-meta-tags"><a href="/datascience-blog/tag/altair" data-v-43160e8a> altair </a><a href="/datascience-blog/tag/data visualization" data-v-43160e8a> data visualization </a><a href="/datascience-blog/tag/mapping" data-v-43160e8a> mapping </a><a href="/datascience-blog/tag/interactive" data-v-43160e8a> interactive </a><a href="/datascience-blog/tag/geojson" data-v-43160e8a> geojson </a><a href="/datascience-blog/tag/topojson" data-v-43160e8a> topojson </a></div></div></div></div></article> <div class="row justify-content-center" data-v-1c1f12bb><div class="col-md-9" data-v-1c1f12bb><form class="newsletter" data-v-1c1f12bb><div class="newsletter__wrap"><div class="newsletter__title">Newsletter</div> <div class="newsletter__content">Subscribe to get my latest content. No spam.</div> <div class="newsletter__fields"><input type="email" name="email" aria-label="Email" placeholder="Email" required="required" autocapitalize="off" autocorrect="off" data-cy="email" value="" class="newsletter__input"> <button type="submit" data-cy="submit" class="newsletter__button">
        Subscribe
      </button></div></div></form> <!----></div></div> <div class="sticker vuepress-toc" data-v-1c1f12bb><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#what-is-altair" title="What is altair?">What is altair?</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#get-started-plotting" title="Get Started Plotting!">Get Started Plotting!</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#step-1-plot-a-base-map" title="Step 1. Plot a base map">Step 1. Plot a base map</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#step-2-scrape-some-data-for-the-map-to-encode" title="Step 2. Scrape some data for the map to encode">Step 2. Scrape some data for the map to encode</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#step-3-encode-data-to-the-map" title="Step 3. Encode data to the map">Step 3. Encode data to the map</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#step-4-customize-color-scales" title="Step 4. Customize color scales">Step 4. Customize color scales</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#step-5-add-interactive-tooltips" title="Step 5. Add interactive tooltips">Step 5. Add interactive tooltips</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#step-6-share-your-work" title="Step 6: Share your work!">Step 6: Share your work!</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#summary" title="Summary:">Summary:</a></div></div></div></div> <footer class="themefooter"><div class="container"><div class="row justify-content-between"><div class="col"><a href="/"><img src="/datascience-blog/assets/img/logo-white.png" class="logofooter"></a> <div class="footer-subtitle">
          A Data Science Blog by Paul Xu
        </div></div> <div class="col text-right"><ul class="list-unstyled"><li class="contact-item"><a href="https://github.com/wowthemesnet/mediumish-vuepress-blog-theme" target="_blank" rel="noopener noreferrer" class="external"><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
              
            </a></li><li class="contact-item"><a href="https://www.linkedin.com/in/paulxubc/" target="_blank" rel="noopener noreferrer" class="external"><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-linkedin"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
              
            </a></li><li class="contact-item"><a href="https://twitter.com/paulxu_bc" target="_blank" rel="noopener noreferrer" class="external"><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
              
            </a></li><li class="contact-item"><a href="https://thepolicylab.brown.edu/team/paul-xu/" target="_blank" rel="noopener noreferrer" class="external"><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-globe"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
              
            </a></li></ul> <ul class="list-unstyled"><li class="copyright-item"><a href="/datascience-blog/2020/07/17/the-easiest-and-fastest-way-to-create-beautiful-interactive-maps-in-python/.html#">Copyright Â© Paul Xu 2020.</a></li><li class="copyright-item"><a href="https://bootstrapstarter.com/bootstrap-templates/vuepress-theme-mediumish/" target="_blank" rel="noopener noreferrer" class="external">Made with Mediumish - free Vuepress theme</a></li></ul></div></div></div></footer></div><div class="global-ui"><!----></div></div>
    <script src="/datascience-blog/assets/js/app.b17b81b1.js" defer></script><script src="/datascience-blog/assets/js/7.7ac7c303.js" defer></script><script src="/datascience-blog/assets/js/3.ea1e0928.js" defer></script><script src="/datascience-blog/assets/js/18.81f8c0a2.js" defer></script><script src="/datascience-blog/assets/js/5.04ce5a0a.js" defer></script><script src="/datascience-blog/assets/js/8.845dbd27.js" defer></script>
  </body>
</html>
