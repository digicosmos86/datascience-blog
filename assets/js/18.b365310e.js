(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{404:function(t,a,e){"use strict";e.r(a);var s=e(8),o=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("If you are like me, you would be fascinated by the beautiful interactive maps (choropleths) on New York Times (see "),e("a",{attrs:{href:"https://www.nytimes.com/interactive/2020/07/17/upshot/coronavirus-face-mask-map.html?action=click&module=Top%20Stories&pgtype=Homepage",target:"_blank",rel:"noopener noreferrer"}},[t._v("this"),e("OutboundLink")],1),t._v(", for example). They are not only informative but also quite eye catching. You can create a map like this in d3.js fairly easily, but it takes time. Plus you would probably need to wrangle some data first in Python first. Is there a way to create interactive maps like this quickly without leaving Python? This article is for you. I will cover the basics in creating interactive choropleths with the "),e("code",[t._v("altair")]),t._v(" package any state or region that you have a "),e("code",[t._v("geojson")]),t._v(" or "),e("code",[t._v("topojson")]),t._v(" for.")]),t._v(" "),e("h2",{attrs:{id:"what-is-altair"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#what-is-altair"}},[t._v("#")]),t._v(" What is "),e("code",[t._v("altair")]),t._v("?")]),t._v(" "),e("p",[e("code",[t._v("altair")]),t._v(" is a relatively new data visualization package for Python that creates "),e("code",[t._v("vega")]),t._v(" and "),e("code",[t._v("vega-lite")]),t._v(" bindings. "),e("code",[t._v("vega")]),t._v(" and "),e("code",[t._v("vega-lite")]),t._v(' are "a '),e("em",[t._v("visualization grammar")]),t._v(', a declarative language for creating, saving, and sharing interactive visualization designs. With Vega, you can describe the visual appearance and interactive behavior of a visualization in a JSON format, and generate web-based views using Canvas or SVG." '),e("code",[t._v("altair")]),t._v(" is a package that creates such JSON files which then can be parsed with "),e("code",[t._v("vega")]),t._v(" and "),e("code",[t._v("vega-lite")]),t._v(" engines that uses d3 under-the-hood to create common types of statistical charts. I have written "),e("RouterLink",{attrs:{to:"/_posts/forget-about-matplotlib.you-should-be-using-altair.html"}},[t._v("a high-level overview")]),t._v(" of "),e("code",[t._v("altair")]),t._v(" that explains why you should be using "),e("code",[t._v("altair")]),t._v(" instead of, say, "),e("code",[t._v("matplotlib")]),t._v(", "),e("code",[t._v("seaborn")]),t._v(", "),e("code",[t._v("bokeh")]),t._v(", or "),e("code",[t._v("plotly")]),t._v(".")],1),t._v(" "),e("h2",{attrs:{id:"get-started-plotting"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#get-started-plotting"}},[t._v("#")]),t._v(" Get Started Plotting!")]),t._v(" "),e("p",[t._v("The easiest way to get started with "),e("code",[t._v("altair")]),t._v(" is in a "),e("code",[t._v("jupyter notebook")]),t._v(" environment. You can start a notebook in "),e("a",{attrs:{href:"https://colab.research.google.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Google Colab"),e("OutboundLink")],1),t._v(" and follow along. If you want to code locally, I recommend "),e("code",[t._v("jupyter lab")]),t._v(" simply because "),e("code",[t._v("altair")]),t._v(" works in Jupyter Lab by default. Follow these commands to set up a virtual environment and start Jupyter Lab. If you prefer other IDEs, please refer to "),e("a",{attrs:{href:"https://altair-viz.github.io/user_guide/display_frontends.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("this article"),e("OutboundLink")],1),t._v(".")]),t._v(" "),e("h3",{attrs:{id:"step-1-plot-a-base-map"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step-1-plot-a-base-map"}},[t._v("#")]),t._v(" Step 1. Plot a base map")]),t._v(" "),e("p",[t._v("As a warm up activity, we will be plotting a map of Rhode Island with only outlines and all default settings just to get used to "),e("code",[t._v("altair")]),t._v(". You can start with any "),e("code",[t._v("geojson")]),t._v(" or "),e("code",[t._v("topojson")]),t._v(" file that you want. We are going to be using "),e("a",{attrs:{href:"https://thepolicylab.github.io/UW-211/ri.topo.json",target:"_blank",rel:"noopener noreferrer"}},[t._v("this topojson file of Rhode Island municipalities"),e("OutboundLink")],1),t._v(". It is also the same file that I used to create the map in "),e("a",{attrs:{href:"https://thepolicylab.github.io/UW-211/",target:"_blank",rel:"noopener noreferrer"}},[t._v("this dashboard"),e("OutboundLink")],1),t._v(" to visualize 211 calls received by United Way of Rhode Island.")]),t._v(" "),e("p",[e("code",[t._v("altair")]),t._v(" supports reading data files through http directly. You don't even need to load the json file:")]),t._v(" "),e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" altair "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" alt\n\nri_topo_url "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://thepolicylab.github.io/UW-211/ri.topo.json'")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# A convenience function that converts topojson features to geojson features")]),t._v("\nri_municipalities "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" alt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("topo_feature"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ri_topo_url"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ri'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nalt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Chart"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ri_municipalities"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mark_geoshape"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[t._v("Voila! A map of Rhode Island should show up. It is that easy! Of course, we are not mapping any data to it, but we will get to that soon.")]),t._v(" "),e("p",[t._v("Let's unpack a little bit about what's going on here:")]),t._v(" "),e("ol",[e("li",[e("code",[t._v("altair")]),t._v(" works with both "),e("code",[t._v("geojson")]),t._v(" and "),e("code",[t._v("topojson")]),t._v(" formats, but "),e("code",[t._v("topojson")]),t._v(" needs to be converted to "),e("code",[t._v("geojson")]),t._v(" format before it can be rendered. That's why we use the convenient function "),e("code",[t._v("alt.topo_feature()")]),t._v(" to extract the features from "),e("code",[t._v("topojson")]),t._v(".")]),t._v(" "),e("li",[t._v("The second argument to "),e("code",[t._v("alt.topo_feature()")]),t._v(" is a string that specifies the name of the object in the "),e("code",[t._v("topojson")]),t._v(" that holds the "),e("code",[t._v("geometryCollection")]),t._v(" in topojson. You can typically find it within the "),e("code",[t._v("objects")]),t._v(" object in the "),e("code",[t._v("topojson")]),t._v(" file. In this case, the name of that object is "),e("code",[t._v("ri")]),t._v(". You can click on "),e("a",{attrs:{href:"https://thepolicylab.github.io/UW-211/ri.topo.json",target:"_blank",rel:"noopener noreferrer"}},[t._v("this link to the json file to see its content"),e("OutboundLink")],1)]),t._v(" "),e("li",[t._v("The "),e("code",[t._v("Chart")]),t._v(" object is the top-level object in "),e("code",[t._v("altair")]),t._v(" that provides an entry into the plot. It accepts a data source as its argument. "),e("code",[t._v("altair")]),t._v(" supports many data source types. In this case, it is a geospatial data source. It also accepts pandas DataFrames, geoPandas geoDataFrames, plain jsons, and many others ("),e("a",{attrs:{href:"https://altair-viz.github.io/user_guide/data.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("full documentation here"),e("OutboundLink")],1),t._v("). Notably, it supports urls to "),e("code",[t._v("csv")]),t._v(" and "),e("code",[t._v("json")]),t._v(" formats, so you don't have to download them first.")]),t._v(" "),e("li",[t._v("Because we used "),e("code",[t._v("alt.topo_feature")]),t._v(", "),e("code",[t._v("altair")]),t._v(" knows there is geospatial information in the plot, so it created the plot by default.")]),t._v(" "),e("li",[t._v("We specified that we are creating "),e("code",[t._v("geoshapes")]),t._v(" as marks. We can specify how these shapes should look. These are basically CSS propeties of SVG shapes. If you have experience working with SVGs with CSS, you should be very familiar with the arguments here:")])]),t._v(" "),e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[t._v("alt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Chart"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ri_municipalities"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mark_geoshape"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    fill"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'teal'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    stroke"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#fff'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    strokeWidth"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("properties"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\twidth"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    height"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("800")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    title"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Map of Rhode Island Municipalities"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[t._v("Notice that we can pass these options directly to the "),e("code",[t._v("mark_geoshape()")]),t._v(" method. Here we are "),e("strong",[t._v("specifying")]),t._v(" or "),e("strong",[t._v("assigning")]),t._v(" the properties of the shapes, not "),e("strong",[t._v("mapping")]),t._v(" or "),e("strong",[t._v("encoding")]),t._v(" the properties with data. Next, we are going to encode some data to the map.")]),t._v(" "),e("p",[t._v("We also used the "),e("code",[t._v("properties")]),t._v(" method to specify general properties of the charts, such as height, weight, and title. The "),e("code",[t._v("altair")]),t._v(" API is very well structured and predictable in many ways about how you can use them.")]),t._v(" "),e("h3",{attrs:{id:"step-2-scrape-some-data-for-the-map-to-encode"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step-2-scrape-some-data-for-the-map-to-encode"}},[t._v("#")]),t._v(" Step 2. Scrape some data for the map to encode")]),t._v(" "),e("p",[t._v("Let's simply scrape the population data for Rhode Island municipalities as an example for this post. We can use "),e("code",[t._v("pandas.read_html()")]),t._v(" for this. It basically reads all tables on an html page and saves them as a list of DataFrames. The data source is "),e("a",{attrs:{href:"https://en.wikipedia.org/wiki/List_of_municipalities_in_Rhode_Island",target:"_blank",rel:"noopener noreferrer"}},[t._v("this wikipedia page"),e("OutboundLink")],1),t._v(".")]),t._v(" "),e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" requests\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" pandas "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" pd\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# use requests to obtain the html sourse")]),t._v("\nwiki_page "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" requests"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://en.wikipedia.org/wiki/List_of_municipalities_in_Rhode_Island'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# use pandas to parse the html file and extact all tables")]),t._v("\nri_table "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pd"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read_html"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wiki_page"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nri_pops "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ri_table"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("iloc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("39")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# get rid of the last (total) row")]),t._v("\nri_pops"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("columns "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'City'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Population'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nri_pops"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"City"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ri_pops"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"City"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("upper"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nri_pops"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v("City\tPopulation\nBARRINGTON\t16819\nBRISTOL\t22469\nBURRILLVILLE\t15796\nCENTRAL FALLS\t18928\nCHARLESTOWN\t7859\n")])])]),e("p",[t._v("With this step, we now have a DataFrame of all municipalities in Rhode Island and their populations. The next step would be to "),e("code",[t._v("map")]),t._v(" or "),e("code",[t._v("encode")]),t._v(" this data to the map.")]),t._v(" "),e("h3",{attrs:{id:"step-3-encode-data-to-the-map"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#step-3-encode-data-to-the-map"}},[t._v("#")]),t._v(" Step 3. Encode data to the map")]),t._v(" "),e("p",[t._v("This step is basically to join the population data with the "),e("code",[t._v("topojson")]),t._v(" file. In the "),e("code",[t._v("topojson")]),t._v(" file, each shape is associated with an "),e("code",[t._v("id")]),t._v(" which is the upper-case name of the municipality it represents. We would be using this "),e("code",[t._v("id")]),t._v(" as the key to look up for the corresponding population in the DataFrame that we just created. Normally a join with pandas would solve the problem. The problem here, though, is that we don't have two DataFrames here. This is where "),e("code",[t._v("altair")]),t._v("'s data transformations come in handy. The data transformation API are bindings to "),e("code",[t._v("vega")]),t._v("'s powerful data transformations on JavaScript datasets. In Python, the data transformation API can operate between data saved in JSON format and DataFrame formats, which is very powerful.")]),t._v(" "),e("p",[t._v("Let's slightly modify the code that we created previously to map the population to the color of each shape:")])])}),[],!1,null,null,null);a.default=o.exports}}]);