(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{401:function(t,e,a){"use strict";a.r(e);var s=a(9),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("In this post, we will cover the details in creating the data visualizations used in "),a("a",{attrs:{href:"https://thepolicylab.github.io/UW-211",target:"_blank",rel:"noopener noreferrer"}},[t._v("the United Way Rhode Island 211 Dashboard"),a("OutboundLink")],1),t._v(" to reveal patterns in 211 calls. "),a("a",{attrs:{href:"https://digicosmos86.github.io/datascience-blog/2020/07/10/the-making-of-a-dashboard/",target:"_blank",rel:"noopener noreferrer"}},[t._v("The previous post"),a("OutboundLink")],1),t._v(" described in detail the overall architecture of the app and how data is persisted as state in the Vue app. This post focuses more on the gotchas using d3.js to create interactive data visualizations.")]),t._v(" "),a("p",[t._v("Links to other posts in the series:")]),t._v(" "),a("ul",[a("li",[a("RouterLink",{attrs:{to:"/datascience-blog/2020/07/09/making-of-a-dashboard-part1/"}},[t._v("Part 1. Background and Decisions on Tech Stack")])],1),t._v(" "),a("li",[a("RouterLink",{attrs:{to:"/datascience-blog/2020/07/10/the-making-of-a-dashboard/"}},[t._v("Part 2. Building the Skeleton of the App with Vue.js")])],1),t._v(" "),a("li",[a("a",{attrs:{href:"#"}},[t._v("Part 4. UI/UX Improvements from User Feedback")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#"}},[t._v("Part 5. Wrangling Data for the App")])])]),t._v(" "),a("h2",{attrs:{id:"general-design-patterns"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#general-design-patterns"}},[t._v("#")]),t._v(" General Design Patterns")]),t._v(" "),a("p",[t._v("Each of the visualizations lives within a Vue component. The overall structure of the component looks like this:")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      filteredData"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// stores the result of the filterData method")]),t._v("\n      \n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// persist a chart object with an updateChart method that can be called")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// when the filter is updated.")]),t._v("\n      chart"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  props"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    rawData"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    filter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Object\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  methods"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// inititalizes the chart and returns a chart object with an updateChart method")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initChart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// filters rawData and returns filteredData in the components state")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("filterData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("filteredData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("created")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// filters the data and creates the chart when the component is being created")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filteredData "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("filterData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("chart "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initChart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filteredData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  watch"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    filter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      deep"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// create a "deep watcher" that monitors each element of the object')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("newFilter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filteredData "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("filterData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newFilter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("chart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateChart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filteredData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newFilter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("The above code snippet shows that the component receives as props the 211 data loaded from a "),a("code",[t._v(".csv")]),t._v(" file and a filter objects that contains all of the parameters of the filter. Whenever the component is created (i.e. when the "),a("code",[t._v("created()")]),t._v(" lifecycle method is called), the "),a("code",[t._v("filterData")]),t._v(" method is called and the result is stored in the component's state. Then the "),a("code",[t._v("initChart()")]),t._v(" method is called, returning in a chart object, which is also saved to the component's state. This chart objects itself has an "),a("code",[t._v("updateChart")]),t._v(" method, which can be used to update the chart. This follows the d3.js design pattern described "),a("a",{attrs:{href:"https://medium.com/d3js-tutorials/a-d3-js-design-pattern-16a6503dc86f",target:"_blank",rel:"noopener noreferrer"}},[t._v("in this article"),a("OutboundLink")],1),t._v(" to keep d3 code centralized in the Vue component.")]),t._v(" "),a("p",[t._v("Each component also has a deep "),a("code",[t._v("watcher")]),t._v(" that watches the filter props. Whenever the filter changes, its handler will call the "),a("code",[t._v("filterData")]),t._v(" method again, and then call the "),a("code",[t._v("updateChart")]),t._v(" method of the "),a("code",[t._v("chart")]),t._v(" object persisted in the state to update the chart.")]),t._v(" "),a("h2",{attrs:{id:"let-s-make-the-map"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#let-s-make-the-map"}},[t._v("#")]),t._v(" Let's Make the Map!")]),t._v(" "),a("p",[t._v("Making a map (choropleth) with d3.js is a widely covered subject. There are many tutorials avaiable that walks you through how to create a map using "),a("code",[t._v("geojson")]),t._v("/"),a("code",[t._v("topojson")]),t._v(" in d3. For example, this "),a("a",{attrs:{href:"https://observablehq.com/@d3/choropleth",target:"_blank",rel:"noopener noreferrer"}},[t._v("Observable notebook"),a("OutboundLink")],1),t._v(" by d3's creator Mike Bostock contains code for creating choropleths in d3 v5. "),a("a",{attrs:{href:"https://datawanderings.com/2018/10/28/making-a-map-in-d3-js-v-5/",target:"_blank",rel:"noopener noreferrer"}},[t._v("This article"),a("OutboundLink")],1),t._v(" is also a great tutorial for creating such maps. What I want to cover in this section is a few things that got me stuck for hours.")]),t._v(" "),a("h3",{attrs:{id:"_1-finding-the-correct-geojson-topojson-for-the-base-map"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-finding-the-correct-geojson-topojson-for-the-base-map"}},[t._v("#")]),t._v(" 1. Finding the correct "),a("code",[t._v("geojson/topojson")]),t._v(" for the base map")]),t._v(" "),a("p",[t._v("Typically you should have no difficulties finding a "),a("code",[t._v("geojson")]),t._v("/"),a("code",[t._v("topojson")]),t._v(" file that contains the correct border outlines for the geographical information that you want to plot. However, these files are made to be very precise and tend to be too big for a project like this. The "),a("code",[t._v("geojson")]),t._v(" file that I got at first from the "),a("a",{attrs:{href:"http://www.rigis.org/datasets/municipalities-1997",target:"_blank",rel:"noopener noreferrer"}},[t._v("RI GIS website"),a("OutboundLink")],1),t._v(" was over 6MB. I tried to use "),a("a",{attrs:{href:"https://mapshaper.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("MapShaper"),a("OutboundLink")],1),t._v(" to reduce the file size but d3 had problems reading the files it produced. I eventually found a "),a("code",[t._v("topojson")]),t._v(" file that was small enough. So, you might need to spend some time finding the right files for the base map, especailly if you are focusing on a state or a smaller region.")]),t._v(" "),a("h3",{attrs:{id:"_2-using-the-correct-projection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-using-the-correct-projection"}},[t._v("#")]),t._v(" 2. Using the correct projection")]),t._v(" "),a("p",[t._v("We will need a projection function that projects geographic coordinates to planar coordinates that can be used to draw SVG paths with d3.js. If we were creating a map of the United States, then the "),a("code",[t._v("AlbersUSA")]),t._v(" projection comes in quite handy. In this project, I used the "),a("code",[t._v("mercator")]),t._v(" projection, which had to be scaled over 30,000 times with numerous trials and errors to make the map look the way it is. I welcome any comment/feedback on other ways to project the map of states that does not require as much correction.")]),t._v(" "),a("h3",{attrs:{id:"_3-the-infamous-maup-problem"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-the-infamous-maup-problem"}},[t._v("#")]),t._v(" 3. The infamous MAUP problem")]),t._v(" "),a("p",[t._v("Another problem that I encontered when mapping the 211 call data is this so-called Modifiable area unit problem (MAUP), which, in this context, means that the number of calls plotted on a map is a reflection of that area's population density. In this case, since Providence is RI's only population center, naturally many more 211 calls would originate from Providence, which results in a map with only Providence highlighted. I modified the color scale to reflect the number of calls per 1000 capita to preserve some interpretability. I also welcome any suggestions/comments on other ways to produce maps that are less biased by population density.")]),t._v(" "),a("h2",{attrs:{id:"stacked-area-chart-with-smooth-transitions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#stacked-area-chart-with-smooth-transitions"}},[t._v("#")]),t._v(" Stacked Area Chart with Smooth Transitions")]),t._v(" "),a("p",[t._v("As with the Map, we are not going to be concerned with how to create a stacked area chart in d3.js. "),a("a",{attrs:{href:"https://www.d3-graph-gallery.com/graph/stackedarea_template.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("This great tutorial"),a("OutboundLink")],1),t._v(" covers this topic thoroughly and nicely. Also, I would recommend that you use a library such as "),a("code",[t._v("vega")]),t._v(", "),a("code",[t._v("vega-lite")]),t._v(", "),a("code",[t._v("chart.js")]),t._v(", "),a("code",[t._v("c3.js")]),t._v(", "),a("code",[t._v("apex charts")]),t._v(" and any other JavaScript charting library to create it, because while creating the area chart itself is not difficult, creating informative tooltips can be quite involved. Here, we are using plain d3 for two reasons. First, there are too many categories in the data and we would like to only display major categories when all categories are shown. That means we will need to customize the legend a little bit. Second, we also want to create smooth transition animations when the data changes. We cannot achieve such deep customization with a library.  The rest of this section will focus on how we created the smooth transition animations for the stacked area chart shown below. We will also touch upon some gotchas in data wrangling in the browser with d3, and how to display time series data properly with time scales.")]),t._v(" "),a("p",[a("img",{attrs:{src:"/datascience-blog/assets/img/stackbarchart.gif",alt:""}})]),t._v(" "),a("h3",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[t._v("#")])])])}),[],!1,null,null,null);e.default=n.exports}}]);